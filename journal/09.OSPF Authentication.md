# OSPF Authentication Lab

OSPF authentication prevents unauthorized devices from injecting routing information into an OSPF domain. There are three common modes you will see in IOS style configurations:

- Null authentication  
  - No authentication is used. OSPF packets are accepted without checking credentials. Use only in trusted labs or where there is no risk of rogue routers.

- Simple authentication (cleartext)  
  - The router transmits a cleartext password with OSPF packets. The neighbor checks the password and forms adjacency only if the password matches. This is easy to configure but insecure on shared networks because the password can be captured.

- MD5 message-digest authentication  
  - Uses HMAC-MD5 with a key id and a key string. The key id lets you have multiple keys and rotate them. MD5 provides integrity and authentication, and is preferred over simple authentication for production where stronger crypto like HMAC-SHA is not available. MD5 is configured on interfaces and can be set as the area default too.

Key points and best practices

- Always configure authentication consistently between neighbors. If one side uses MD5 and the other uses null or simple, adjacency will not form.  
- Area-wide authentication settings establish a default for the area. Interface-level commands can override that default. This lab intentionally demonstrates that per-interface null can negate an area-wide MD5 setting, causing adjacency failure.  
- Use MD5 or stronger authentication where possible. Rotate keys periodically. Keep keys secure. Avoid simple authentication in production.  
- When troubleshooting adjacency issues, always check authentication configuration first before complex routing issues.

This lab demonstrates OSPF authentication types and how they affect adjacency and routing. 
## Topology and area layout

![Topology](https://github.com/RouteSeeker/CCNP_Security/blob/main/assets/screenshots/09.OSPF%20Authentication/01.Topology%20diagram.png)

Note: Area 0 is configured to use MD5 message-digest authentication globally, but the R3-R4 specific link uses null authentication to demonstrate interface-level override and its effect on adjacency.

---

### Global area authentication for Area 0

```
conf t

router ospf 1

area 0 authentication message-digest

exit
````

Explanation

* `area 0 authentication message-digest`

  * Configure area 0 to use MD5 message-digest authentication by default. This sets the area default. Interfaces in area 0 will expect MD5 unless they are configured otherwise at the interface level.


Why this is used

* Setting the area-level MD5 enforces a secure default for all links in area 0. 
---

### MD5 authentication on Area 0 interfaces
#### R1

```
int range g0/0-1
ip ospf message-digest-key 1 md5 Cisco!23
```

Explanation

* `ip ospf message-digest-key 1 md5 Cisco!23`

  * Configures MD5 authentication with key id 1 and key string `Cisco!23` on the selected interfaces. The router will use MD5 HMAC with the specified key to authenticate OSPF packets on those interfaces.

Why use this

* Setting the per-interface MD5 key ensures that neighbors on these interfaces can form OSPF adjacency using MD5. The key id allows future key rotation by adding another key id and switching.

#### Core1

```
int range g0/0-1
ip ospf message-digest-key 1 md5 Cisco!23
```

#### R2

```cisco
int range g0/0-1
ip ospf message-digest-key 1 md5 Cisco!23
```

#### R3

```
int g0/1
ip ospf message-digest-key 1 md5 Cisco!23
```

#### R4

```
int g0/1
ip ospf message-digest-key 1 md5 Cisco!23
```

---

### Null authentication on the R3-R4 link (interface-level override)

The lab deliberately sets null authentication on the R3-R4 link to demonstrate the effect of per-interface overrides.

#### R3

```
int g0/0
ip ospf authentication null
```

Explanation

* `int g0/0` selects the interface that connects R3 to R4.
* `ip ospf authentication null` configures this interface to use null authentication, overriding the area-level MD5 default. Null means no authentication is used on this interface.

Why this matters

* Because area 0 is set to MD5, neighbors expecting MD5 will not accept cleartext or null-authenticated packets. If one side uses MD5 and the other side uses null, adjacency will fail. This demonstrates that interface-level config can negate area-level defaults and break OSPF if not carefully applied.

#### R4

```
int g0/0
ip ospf authentication null
```

---

### Area 1 simple authentication configuration and per-interface keys

```
router ospf 1
area 1 authentication
area 2 authentication message-digest
```

Explanation

* `area 1 authentication` sets area 1 to use simple cleartext authentication by default.
* `area 2 authentication message-digest` sets area 2 to use MD5 message-digest authentication by default.


#### R3

```
int g0/2
ip ospf authentication-key Cisco!23
```

Explanation

* `ip ospf authentication-key Cisco!23` sets the simple (cleartext) password to `Cisco!23` on this interface. Neighbors on the same interface must have the same password to form adjacency.

#### R5

```
int range g0/2-3
ip ospf authentication-key Cisco!23
```

#### R7

```
int g0/3
ip ospf authentication-key Cisco!23
```

---

### Area 2 MD5 authentication per-interface
#### Area-level

```
router ospf 1
area 2 authentication message-digest
```

Explanation

* This sets area 2 default authentication to MD5.

#### R4

```
int g0/2
ip ospf message-digest-key 1 md5 Cisco!23
```

Explanation

* Selects R4 interface g0/2 and configures MD5 key id 1 with key string `Cisco!23`.

#### R6

```
int range g0/2-3
ip ospf message-digest-key 1 md5 Cisco!23
```

#### R8

```
int g0/3
ip ospf message-digest-key 1 md5 Cisco!23
```

---

## Verification
### Basic OSPF process summary

```cisco
show ip ospf
```

![show ip ospf](https://github.com/RouteSeeker/CCNP_Security/blob/main/assets/screenshots/09.OSPF%20Authentication/09.show%20ip%20ospf.png)

What it does

* Shows an overview of the OSPF process, including router ID, OSPF timers, the number of areas, and total LSAs.

Why use it

* Use this first to confirm the OSPF process is running and to get a quick global view.

### Check OSPF neighbors per area and interfaces

```
show ip ospf neighbor
show ip ospf neighbor detail
```

![Show ip ospf neighbor](https://github.com/RouteSeeker/CCNP_Security/blob/main/assets/screenshots/09.OSPF%20Authentication/02.show_ip_ospf_neighbor.png)

![Show ip ospf neighbor detail](https://github.com/RouteSeeker/CCNP_Security/blob/main/assets/screenshots/09.OSPF%20Authentication/03.show%20ip%20ospf%20neighbor.png)

What it does

* `show ip ospf neighbor` lists OSPF neighbors and their state per interface.
* `show ip ospf neighbor detail` provides more information about adjacency, including neighbor ID, state, and DR/BDR roles.

Why use it

* Confirm whether neighbors have formed adjacency. If a neighbor is stuck in the EXSTART or INIT state, authentication mismatch is a common cause.

### Check OSPF interface authentication and status

```
show ip ospf interface
show ip ospf interface g0/0
```

![show ip ospf interface](https://github.com/RouteSeeker/CCNP_Security/blob/main/assets/screenshots/09.OSPF%20Authentication/04.show%20ip%20ospf%20interface.png)

What it does

* `show ip ospf interface` displays OSPF parameters for all interfaces, including authentication type, area, hello and dead timers.
* `show ip ospf interface g0/0` narrows the output to the specified interface.

Why use it

* Use these commands to verify whether the interface is using null, simple, or message-digest authentication, and to check if the interface is up for OSPF.

### Check OSPF database and LSA details

```cisco
show ip ospf database
show ip ospf database router
show ip ospf database network
```

![show ip ospf database](https://github.com/RouteSeeker/CCNP_Security/blob/main/assets/screenshots/09.OSPF%20Authentication/05.show%20ip%20ospf%20database.png) 

![database network](https://github.com/RouteSeeker/CCNP_Security/blob/main/assets/screenshots/09.OSPF%20Authentication/06.show%20ip%20ospf%20database%20network.png)

What it does

* Shows the OSPF link state database and types of LSAs.

Why use it

* Verify whether LSAs are being exchanged. If adjacency fails due to authentication mismatch, LSAs will not be received from that neighbor.


### Check per-interface authentication keys and configuration

```
show running-config | section interface
show running-config | section router ospf
```

![section interface](https://github.com/RouteSeeker/CCNP_Security/blob/main/assets/screenshots/09.OSPF%20Authentication/07.running-config.png) 

![router ospf](https://github.com/RouteSeeker/CCNP_Security/blob/main/assets/screenshots/09.OSPF%20Authentication/08.running-config%20ospf.png)

What it does

* Displays interface configuration and OSPF router configuration sections from the running config.

Why use it

* Use these to confirm key strings, key ids, and whether the intended authentication commands are present on the interfaces and in router ospf.


---

## Troubleshooting tips and common causes

If adjacency is not forming do this checklist in order:

1. Confirm OSPF process is running with `show ip ospf`.
2. Check neighbor state with `show ip ospf neighbor`. If state is anything other than FULL or 2WAY on a point-to-point, investigate authentication.
3. Examine interface-level OSPF auth configuration with `show ip ospf interface` and `show running-config | section interface`. Verify the `ip ospf message-digest-key` or `ip ospf authentication-key` lines match on both sides.
4. If area-level authentication is set but an interface uses `ip ospf authentication null` or a different auth type, adjacency will fail. Verify area vs interface settings.
5. Check key id and key string. A mismatch in key id will cause failure even if the key string matches. The key id is the numeric value you see in the `ip ospf message-digest-key 1 md5 <key>` command.
6. If adjacency fails and logs are inconclusive, run `debug ip ospf adj` to watch the neighbor negotiation. Stop debug once you have evidence.
7. For simple authentication, confirm cleartext `ip ospf authentication-key` matches on both ends. For MD5, ensure `ip ospf message-digest-key` matches on both ends.
8. After fixing keys or interface commands, clear the adjacency and let neighbors reconverge, for example `clear ip ospf process` or `clear ip ospf neighbor <neighbor-id>` as appropriate in the lab.

---

## Key management and best practices

* Use MD5 or stronger authentication where possible. If your platform supports HMAC-SHA algorithms for OSPF, prefer them over MD5. In older IOS platforms MD5 is commonly used.
* Rotate keys regularly. Use different key ids so you can stage key rotation: add new key id and new key on both neighbors, then switch the active key id.
* Keep keys out of configuration backups that go to insecure storage. Use secure vaults or encrypted templates if possible.
* Document keys and rotation schedule in your change control.

Sample key rotation flow 

* Add key id 2 with the new key on both neighbors `ip ospf message-digest-key 2 md5 NewKey123`.
* Change the active key id if your platform requires it or let it prefer the new key if configured.
* Remove old key id 1 after verification.

---

## Summary

In this lab we explored how OSPF authentication works and why it matters in building stable and secure routing domains.  

We configured three types of authentication:  
- **MD5 message-digest authentication** for Area 0 and Area 2 to ensure integrity and authentication of OSPF packets.  
- **Null authentication** on the R3–R4 link to highlight how an interface override can break adjacency despite area-wide settings.  
- **Simple password authentication** in Area 1 to show how cleartext authentication operates and why it is less secure.  
 
