# 08. VRF-Lite Lab

In this lab we explore **VRF-Lite**, a feature that allows us to maintain multiple routing instances on the same physical device. The goal is to provide customer separation and even allow overlapping IP address spaces without requiring MPLS.  

We will use two switches (SW1 and SW2) connected via trunk on g0/0, and create two VRFs called `Cust1` and `Cust2`. Each customer will have two VLANs, and we will configure SVIs, routing protocols, and DHCP per VRF.  

![topology](https://github.com/RouteSeeker/CCNP_Security/blob/main/assets/screenshots/08.VRF-Lite/01.topology.png) 

---

VRF-Lite allows multiple routing tables to exist on the same router or switch. This separation ensures that traffic from one customer does not mix with another, even if they use the same IP addressing.  

Unlike MPLS VRF, VRF-Lite does not use label switching. Instead, the separation is done locally by binding interfaces and routing processes to different VRFs.

---

## SW1 Configuration

### Step 1: Define VRFs
```
vrf definition Cust1
 description Routing for Cust1
 address-family ipv4
 exit
exit

vrf definition Cust2
 description Routing for Cust2
 address-family ipv4
 exit
exit
````

This creates two VRFs, each with its own IPv4 routing table.

---

### Step 2: VLANs and trunk

```
vlan 101
 name Cust1-VLAN-101
vlan 102
 name Cust1-VLAN-102
vlan 201
 name Cust2-VLAN-201
vlan 202
 name Cust2-VLAN-202
exit

interface g0/0
 switchport trunk encapsulation dot1q
 switchport mode trunk
 exit
```

Defines VLANs for each customer and configures g0/0 as the trunk between SW1 and SW2.

---

### Step 3: SVIs

```
interface vlan 101
 vrf forwarding Cust1
 ip address 10.101.0.1 255.255.255.0
 no shutdown
 exit

interface vlan 102
 vrf forwarding Cust1
 ip address 10.12.0.1 255.255.255.0
 no shutdown
 exit

interface vlan 201
 vrf forwarding Cust2
 ip address 10.201.0.1 255.255.255.0
 no shutdown
 exit

interface vlan 202
 vrf forwarding Cust2
 ip address 10.12.0.1 255.255.255.0
 no shutdown
 exit
```

Each SVI is bound to its respective VRF. Notice that both Cust1 and Cust2 use the 10.12.0.0/24 subnet. VRF separation makes this possible.

---

## SW2 Configuration

### Step 1: Define VRFs

```
vrf definition Cust1
 description Routing for Cust1
 address-family ipv4
 exit
exit

vrf definition Cust2
 description Routing for Cust2
 address-family ipv4
 exit
exit
```

### Step 2: VLANs and trunk

```
vlan 101
 name Cust1-VLAN-101
vlan 102
 name Cust1-VLAN-102
vlan 201
 name Cust2-VLAN-201
vlan 202
 name Cust2-VLAN-202
exit

interface g0/0
 switchport trunk encapsulation dot1q
 switchport mode trunk
 exit
```

### Step 3: SVIs

```
interface vlan 101
 vrf forwarding Cust1
 ip address 10.101.0.2 255.255.255.0
 no shutdown
 exit

interface vlan 102
 vrf forwarding Cust1
 ip address 10.12.0.2 255.255.255.0
 no shutdown
 exit

interface vlan 201
 vrf forwarding Cust2
 ip address 10.201.0.2 255.255.255.0
 no shutdown
 exit

interface vlan 202
 vrf forwarding Cust2
 ip address 10.12.0.2 255.255.255.0
 no shutdown
 exit
```

SW2 mirrors SW1, providing gateways ending with `.2`.

---

## Routing

### Cust1 – OSPF

```
router ospf 1 vrf Cust1
 network 0.0.0.0 255.255.255.255 area 0
 exit
```

OSPF is enabled within Cust1’s VRF to advertise connected subnets.

### Cust2 – EIGRP

```
router eigrp Cust2-EIGRP
 address-family ipv4 vrf Cust2 autonomous-system 1
 network 0.0.0.0
 exit
 exit
```

EIGRP runs inside Cust2’s VRF. This separation ensures each VRF has its own routing process.

### Loopbacks and default route

```
interface loopback 0
 vrf forwarding Cust1
 ip address 1.1.1.1 255.255.255.255
 exit

router ospf 1 vrf Cust1
 default-information originate always
 exit

interface loopback 0
 vrf forwarding Cust2
 ip address 2.2.2.2 255.255.255.255
 exit
```

Loopbacks are used to simulate internal resources. SW1 injects a default route into Cust1.

---

## DHCP (SW2)

```
ip dhcp excluded-address vrf Cust1 10.101.0.1 10.101.0.20
ip dhcp excluded-address vrf Cust1 10.12.0.1 10.12.0.20
ip dhcp excluded-address vrf Cust2 10.12.0.1 10.12.0.20
ip dhcp excluded-address vrf Cust2 10.201.0.1 10.201.0.20

ip dhcp pool 101-subnet
 network 10.101.0.0 /24
 default-router 10.101.0.2
 vrf Cust1
 yes
 exit

ip dhcp pool 12-subnet-Cust1
 network 10.12.0.0 /24
 default-router 10.12.0.2
 vrf Cust1
 yes
 exit

ip dhcp pool 201-subnet
 network 10.201.0.0 /24
 default-router 10.201.0.2
 vrf Cust2
 yes
 exit

ip dhcp pool 12-subnet-Cust2
 network 10.12.0.0 /24
 default-router 10.12.0.2
 vrf Cust2
 yes
 exit
```

Each pool is bound to a VRF so that DHCP clients get the right scope.

---

## Access Ports

```
interface g1/0
 switchport host
 switchport access vlan 101
 exit

interface g1/1
 switchport host
 switchport access vlan 102
 exit

interface g1/2
 switchport host
 switchport access vlan 201
 exit

interface g1/3
 switchport host
 switchport access vlan 202
 exit
```

Each access port is mapped to a VLAN, which in turn belongs to a VRF.

---

## Verification

```
show vrf
```
![show vrf](https://github.com/RouteSeeker/CCNP_Security/blob/main/assets/screenshots/08.VRF-Lite/02.show-vrf.png)

Displays VRFs configured.

```
show ip route vrf Cust1
show ip route vrf Cust2
```
![show ip route vrf](https://github.com/RouteSeeker/CCNP_Security/blob/main/assets/screenshots/08.VRF-Lite/03.show-ip-route-vrf-cust.png)

Shows routes per VRF.

```
show ip ospf neighbor 
```
![show ip ospf neighbors](https://github.com/RouteSeeker/CCNP_Security/blob/main/assets/screenshots/08.VRF-Lite/04.show-ip-ospf.png)

Checks OSPF adjacencies in Cust1.


```
show eigrp address-family ipv4 vrf Cust2 interfaces
show ip eigrp vrf Cust2 neighbors
```
![show eigrp neighbors](https://github.com/RouteSeeker/CCNP_Security/blob/main/assets/screenshots/08.VRF-Lite/05.show-ip-eigrp-neighbors.png)

Verifies EIGRP for Cust2.


```
ping vrf Cust1 1.1.1.1
ping vrf Cust2 2.2.2.2
```
![ping test](https://github.com/RouteSeeker/CCNP_Security/blob/main/assets/screenshots/08.VRF-Lite/06.ping-test.png)

Tests connectivity to loopbacks.


---

## What We Have Learnt

In this lab we implemented VRF-Lite for customer separation on two switches. We learned how to:

* Create VRFs with independent routing tables
* Bind VLANs and SVIs to VRFs
* Run OSPF inside Cust1 and EIGRP inside Cust2
* Configure DHCP per VRF
* Verify operation using routing, interface, and DHCP commands

This demonstrates how VRF-Lite can provide customer or departmental isolation while allowing overlapping IP addressing.

